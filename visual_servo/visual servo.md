# visual servo（VS，视觉伺服）

## 最简单的口述原理
将图像坐标系的点和相机坐标系下的3D点对应起来。
图像上看，是2D当前点朝着2D示教点（注册时的点）移动；对应到相机坐标系，就是一个3D点在以曲线轨迹移动到3D示教点。这个移动就需要角速度和线速度（即公式中的角速度和线速度）。
整个过程都与世界坐标系无关，故不需要外参。
内参的影响也不大。
只需要将图像坐标系的X/Y轴与相机坐标系下的X/Y轴的方向对应好就行。这就是所谓的visual servo标定（只需要标定方向）。

## 原理
视觉伺服控制是一种基于视觉反馈的控制方式。属于机器人学。
基于运动学的无标定视觉伺服控制器。所以控制器输入是各关节的期望轨迹。
IBVS：通过关联2D图像像素与机器人运动矢量，然后最小化误差（即收敛）。

传统的IBVS 采用的是图像点特征，除此之外还有两种较为常见的图像特征，一是基于霍夫空间的线特征，二是区域性特征(也称作图像矩)。其中，为了实现图像特征的旋转不变性，从而为后续的控制模块中平移与旋转解耦(见1.2) 做铺垫，学者们提出了两种方案，一种是统一球体模型(unitary sphere)，另外一种是虚拟图像平面模型(virtual image plane)

本身不需要相机外参，只是机器人运动才需要外参（只需要一个方向，来将机器人坐标系和图像坐标系对齐）。


ai输出的结果并不是直接用于vs，在vs之前有各种滤波（包括低通滤波、卡尔曼滤波）。
实测中，vs的各种滤波导致了更大的误差，或者最后会冲一下。后来把这些滤波关闭，就正常了。


### 与其他2D图像得到6Dpose算法的比较
visual servo方案是从kp得到delta pose，最终收敛得到一个最终的pose。
其他2D的AI方案是从kp直接得到最终pose。
两者唯一不同就是“如何从kp得到最终pose”，所以本质上所有case中既可以选择visual servo方案又可以选择其他2D的AI方案。
不过从测试效果来看，当物体进行3D运动（即非平面运动）时，visual servo方案的精度更高。

## visual servo的相关参数
- 镜头离物料的距离
- visual servo收敛所允许的像素误差
- 图像分辨率

## 优点
visual servo不需要外参，并且很少依赖于内参。不需要标定。

## 根据算法原理分类（pbvs和ibvs）
1. IBVS (Image-based visual servoing) 基于图像的视觉伺服控制。需要输入kp。
visual servo必须是高精度，像素精度直接对应机器人的精度。例如，100mm的物体，1000分辨率的图片，也就是说1个像素就是0.1mm，这种精度无法达到实用要求。这就导致视野非常小。


2. PBVS (Position-based/Pose-based visual servoing) 基于位置的视觉伺服控制。需要输入pose，如果ai得到的pose很准，就不需要用pbvs了。


3. 混合方式(Hybrid approach)

## 根据机器人末端与像机位置分类
机器人末端执行器（手）和摄像机有两种基本配置：
eye-in-hand 或端点闭环控制(endpoint closed-loop)，将摄像机连接到移动的手并观察目标的相对位置。
eye-to-hand 或端点开环控制(endpoint opend-loop)，将摄像机固定在世界坐标系上，并观察目标和手的运动。


## 影响visual servo最终精度的因素
- 论文中有写长宽比有影响。越是接近正方形，越好。

- KP分布可能有影响。具体而言会影响IBVS的均值。

- 距离越远误差越大。
但对于Z方向不敏感。
应用视觉伺服，提取图像特征的时候，只需要相机拍照一次就可以对吗？相机需要连续工作吗？有一个说法说是要实时估计雅可比矩阵，原因是因为深度信息Z是需要实施估计的，那假如我用一个理想值来代替，这样的话我就可以用一个固定的雅可比矩阵来代替这个试试估计得雅可比矩阵，相机的工作就是拍一张照片，进行特征点提取作为反馈信息，然后与输入信号形成控制信号进行控制就可以了是吧


## 实验结论
PBVS在理论上会给出在三维空间中的最优路径，但在图像平面中为非最优路径，IBVS则相反。
PBVS需要利用图像数据在三维空间位置，因此更容易受到calibration和图像噪声的影响。IBVS则更robust。
IBVS可能导致比较奇怪的三维空间路径，甚至使得目标位置脱离相机的视线。


## 只有两种情况可以到达6自由度
1. AI输出的kp很准，满足一个很小的范围。
2. AI输出的kp的整体均值很准，即均值KP能满足一个很小的范围。

## 发展
最近在调研视觉伺服论文，发现近年论文越来越少了，而且好像它在实际的应用不多，视觉伺服相对于开环机器人控制有什么主要缺点呢。现在多数工业视觉机器人采用的大都是开环控制的视觉机器人是吗？

-------------------------------------------------------
## 视觉伺服任务的应用场景
对于工业是高精度，visual servo少用。但对于家用，精度要求不高，visual servo可能有用。



功能描述：不同于传统的检测方法，视觉伺服将视觉技术和机器人控制系统紧密结合，通过相机拍摄并同步处理图像，能够在短时间内计算出目标位姿反馈给机器人，实现对机器人系统的高准确性和高实时性的控制。

应用场景：区别于传统依赖于精密相机标定的手眼配合方案，视觉伺服系统不受标定精度和机器人定位精度的限制，具备精度高、灵活性强的特点。因此，视觉伺服技术可以应用于一些复杂的、精度要求高的场景。

精密装配类应用（如精度高于机器人定位精度的场景，视野过小难以精确标定的场景）

自适应随行类应用（目标运动速度不稳定的场景）

参考项目：
FPC柔性插装（精度要求高、物料自由度高）
车门随行涂胶（目标物体运动不恒定）

风险提示：
视觉伺服系统要求极高的视觉精度和响应速度，这意味着相机系统必须同时满足：像素精度高、帧率快。因此高精度视觉伺服系统很难在大视野场景下同时发挥高精度、高响应速度的特点。

